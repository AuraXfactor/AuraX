rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ===== ULTRA PERMISSIVE RULES - ALLOW EVERYTHING FOR AUTHENTICATED USERS =====
    
    // Helper function
    function isAuthenticated() {
      return request.auth != null;
    }
    
    // ALL DOCUMENTS - ULTRA PERMISSIVE
    match /{document=**} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    // SPECIFIC COLLECTIONS - EXTRA PERMISSIVE
    match /chats/{chatId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /chats/{chatId}/messages/{messageId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /chats/{chatId}/messages/{messageId}/reactions/{reactionId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /chats/{chatId}/typing/{userId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /posts/{postId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /posts/{postId}/comments/{commentId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /users/{userId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /publicProfiles/{userId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /friendRequests/{requestId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /friends/{userId}/friendships/{friendId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /auraPosts/{postId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /auraPosts/{postId}/reactions/{reactionId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /auraPosts/{postId}/replies/{replyId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /auraStats/{userId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /auraTransactions/{userId}/transactions/{transactionId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /weeklyQuests/{questId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /users/{userId}/questProgress/{questId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /rewards/{rewardId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /userRewards/{userId}/claims/{claimId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /auraSquads/{squadId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /squadLeaderboards/{leaderboardId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /groups/{groupId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /groupMembers/{groupId}/{userId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /journals/{userId}/entries/{entryId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /specialized-journals/{userId}/{journalType}/{entryId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /user-goals/{userId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /boosts/{boostId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /userBoosts/{userId}/entries/{entryId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /notifications/{userId}/{notificationId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /analytics/{collection=**} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    // Legacy collections
    match /enhancedChats/{chatId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /enhancedChats/{chatId}/messages/{messageId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /users/{userId}/chats/{chatId}/messages/{messageId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /users/{userId}/chatMeta/{chatId} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
    
    match /users/{userId}/chats/{chatId}/typing/{otherUid} {
      allow read, write, create, update, delete: if isAuthenticated();
    }
  }
}